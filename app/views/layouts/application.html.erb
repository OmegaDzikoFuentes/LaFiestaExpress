<!DOCTYPE html>
<html>
  <head>
    <title>La Fiesta Express</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "mobile_navigation", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <%= javascript_include_tag "mobile_navigation", "data-turbo-track": "reload" %>
    
    <!-- Add Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  </head>

  <body class="bg-gray-50">
    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="mobile-menu-overlay md:hidden"></div>
    
    <!-- Navigation Header -->
    <nav class="bg-white  shadow-lg sticky top-0 z-50 navbar">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <!-- Logo -->
          <div class="flex items-center">
            <%= link_to root_path, class: "flex items-center", id: "logo-link" do %>
              <%= image_tag "chatXLogo.png", alt: "La Fiesta Express Logo", class: "h-14 w-auto mr-4 logo-image" %>
            <% end %>
          </div>

          <!-- Desktop Navigation Links -->
          <div class="hidden md:flex items-center space-x-8">
            <%= link_to "Menu", categories_path, class: "nav-link text-gray-700", onclick: "scrollToMenu(event)" %>
            <%= link_to "About", restaurant_info_path, class: "nav-link text-gray-700" %>
            
            <% if user_signed_in? %>
              <!-- Cart Icon -->
              <%= link_to orders_path, class: "relative text-gray-700 hover:text-mexican transition-colors p-2" do %>
                <i class="fas fa-shopping-cart text-lg"></i>
                <% if session[:order_id] %>
                  <span class="absolute -top-1 -right-1 bg-mexican text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-semibold">
                    <%= current_user.orders.find_by(id: session[:order_id])&.order_items&.count || 0 %>
                  </span>
                <% end %>
              <% end %>
              
              <!-- Desktop User Dropdown -->
              <div class="relative group desktop-user-dropdown">
                <button class="flex items-center text-gray-700 hover:text-mexican transition-colors font-medium px-3 py-2 rounded-lg hover:bg-gray-50">
                  <i class="fas fa-user-circle text-lg mr-2"></i>
                  <%= current_user.first_name %> 
                  <i class="fas fa-chevron-down ml-2 text-sm"></i>
                </button>
                <div class="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                  <div class="py-2">
                    <%= link_to profile_path, class: "flex items-center px-4 py-3 text-gray-700 hover:bg-gray-50 transition-colors" do %>
                      <i class="fas fa-user text-mexican mr-3"></i>
                      My Profile
                    <% end %>
                    
                    <%= link_to orders_path, class: "flex items-center px-4 py-3 text-gray-700 hover:bg-gray-50 transition-colors" do %>
                      <i class="fas fa-receipt text-mexican mr-3"></i>
                      My Orders
                    <% end %>
                    
                    <%= link_to loyalty_cards_path, class: "flex items-center px-4 py-3 text-gray-700 hover:bg-gray-50 transition-colors" do %>
                      <i class="fas fa-gift text-mexican mr-3"></i>
                      Loyalty Card
                    <% end %>
                    
                    <% if current_user.admin? %>
                      <div class="border-t border-gray-100 mt-2 pt-2">
                        <%= link_to admin_dashboard_path, class: "flex items-center px-4 py-3 text-gray-700 hover:bg-gray-50 transition-colors" do %>
                          <i class="fas fa-cogs text-mexican mr-3"></i>
                          Admin Panel
                        <% end %>
                      </div>
                    <% end %>
                    
                    <div class="border-t border-gray-100 mt-2 pt-2">
                      <%= button_to logout_path, method: :delete, class: "flex items-center w-full px-4 py-3 text-red-600 hover:bg-red-50 transition-colors border-0 bg-transparent text-left" do %>
                        <i class="fas fa-sign-out-alt mr-3"></i>
                        Sign Out
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            <% else %>
              <%= link_to "Login", login_path, class: "bg-mexican text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition-all duration-300 font-medium shadow-md hover:shadow-lg" %>
            <% end %>
          </div>

          <!-- Mobile menu button -->
          <div class="md:hidden">
            <button id="mobile-menu-button" class="mobile-menu-button text-gray-700 hover:text-mexican transition-colors" type="button">
              <i class="fas fa-bars text-lg"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Mobile Menu -->
      <div id="mobile-menu" class="mobile-menu md:hidden">
        <div class="mobile-menu-content">
          <!-- Main Navigation Links -->
          <%= link_to "Menu", categories_path, class: "mobile-menu-link", onclick: "scrollToMenu(event)" %>
          <%= link_to "About", restaurant_info_path, class: "mobile-menu-link" %>
          
          <% if user_signed_in? %>
            <!-- User Section -->
            <div class="mobile-user-section">
              <div class="mobile-user-info">
                <i class="fas fa-user-circle"></i>
                <span><%= current_user.first_name %> <%= current_user.last_name %></span>
              </div>
              
              <%= link_to profile_path, class: "mobile-user-link" do %>
                <i class="fas fa-user"></i> My Profile
              <% end %>
              
              <%= link_to orders_path, class: "mobile-user-link" do %>
                <i class="fas fa-shopping-cart"></i> My Orders
                <% if session[:order_id] && current_user.orders.find_by(id: session[:order_id])&.order_items&.count.to_i > 0 %>
                  <span class="mobile-cart-badge">
                    <%= current_user.orders.find_by(id: session[:order_id])&.order_items&.count || 0 %>
                  </span>
                <% end %>
              <% end %>
              
              <%= link_to loyalty_cards_path, class: "mobile-user-link" do %>
                <i class="fas fa-gift"></i> Loyalty Card
              <% end %>
              
              <% if current_user.admin? %>
                <%= link_to admin_dashboard_path, class: "mobile-user-link" do %>
                  <i class="fas fa-cogs"></i> Admin Panel
                <% end %>
              <% end %>
              
              <%= button_to logout_path, method: :delete, class: "mobile-logout-button" do %>
                <i class="fas fa-sign-out-alt"></i> Sign Out
              <% end %>
            </div>
          <% else %>
            <!-- Login Section -->
            <div class="mobile-login-section">
              <%= link_to "Login", login_path, class: "mobile-login-button" %>
            </div>
          <% end %>
        </div>
      </div>
    </nav>

    <!-- Flash Messages -->
    <% if notice %>
      <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mx-4 mt-4" role="alert">
        <div class="flex items-center">
          <i class="fas fa-check-circle mr-2"></i>
          <%= notice %>
        </div>
      </div>
    <% end %>
    
    <% if alert %>
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mx-4 mt-4" role="alert">
        <div class="flex items-center">
          <i class="fas fa-exclamation-triangle mr-2"></i>
          <%= alert %>
        </div>
      </div>
    <% end %>

    <!-- Main Content -->
    <main>
      <%= yield %>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-16">
      <div class="max-w-7xl mx-auto px-4 py-10 space-y-8">
        
        <!-- Brand / Description -->
        <div>
          <h3 class="text-2xl font-semibold mb-2">La Fiesta Express</h3>
          <p class="text-gray-300">Authentic Mexican cuisine made with love and tradition.</p>
        </div>

        <!-- Info Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center text-gray-300">
          
          <!-- Location -->
          <div class="flex flex-col items-center">
            <i class="fas fa-map-marker-alt text-red-500 text-3xl mb-2"></i>
            <p class="font-semibold text-white">Location</p>
            <p class="text-gray-400">
              <% if @restaurant_info %>
                <%= @restaurant_info.street %>, <%= @restaurant_info.city %>, <%= @restaurant_info.state %> <%= @restaurant_info.zip_code %>
              <% else %>
                1133 West Main Street, Troy, OH
              <% end %>
            </p>
          </div>

          <!-- Hours -->
          <div class="flex flex-col items-center">
            <i class="fas fa-clock text-red-500 text-3xl mb-2"></i>
            <p class="font-semibold text-white">Hours Today</p>
            <p class="text-gray-400">
              <% if @restaurant_info %>
                <% 
                  today = Date.current.strftime("%A").downcase
                  hours_method = "#{today}_hours"
                  todays_hours = @restaurant_info.respond_to?(hours_method) ? @restaurant_info.send(hours_method) : nil
                %>
                <%= todays_hours || "Call for hours" %>
              <% else %>
                11:00 AM â€“ 9:30 PM
              <% end %>
            </p>
          </div>

          <!-- Phone -->
          <div class="flex flex-col items-center">
            <i class="fas fa-phone text-red-500 text-3xl mb-2"></i>
            <p class="font-semibold text-white">Call Us</p>
            <p class="text-gray-400"><%= @restaurant_info&.phone || "937-703-1371" %></p>
          </div>

        </div>

      </div>
    </footer>

  </body>
</html>