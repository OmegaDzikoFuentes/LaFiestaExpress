<div class="container mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold text-gray-800 mb-8">Admin Dashboard</h1>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <!-- Total Revenue -->
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-xl font-semibold text-gray-700">Total Revenue</h2>
      <p class="text-3xl font-bold text-green-600 mt-2">$<%= sprintf("%.2f", @total_revenue) %></p>
      <p class="text-sm text-gray-500 mt-1">From completed orders</p>
    </div>

    <!-- Total Users -->
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-xl font-semibold text-gray-700">Total Users</h2>
      <p class="text-3xl font-bold text-blue-600 mt-2"><%= User.count %></p>
      <p class="text-sm text-gray-500 mt-1">
        Admins: <%= User.admins.count %> | Customers: <%= User.customers.count %>
      </p>
    </div>

    <!-- Pending Receipt Uploads -->
    <div class="bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-xl font-semibold text-gray-700">Pending Receipt Uploads</h2>
      <p class="text-3xl font-bold text-red-600 mt-2"><%= ReceiptUpload.pending.count %></p>
      <p class="text-sm text-gray-500 mt-1">
        <%= link_to "Review Now", admin_receipt_uploads_path, class: "text-blue-600 hover:underline" %>
      </p>
    </div>
  </div>

  <!-- Popular Menu Items Chart -->
  <div class="bg-white p-6 rounded-lg shadow-md mb-8">
    <h2 class="text-xl font-semibold text-gray-700 mb-4">Popular Menu Items</h2>
    <canvas id="popularItemsChart" height="100"></canvas>
  </div>

  <!-- Recent Orders -->
  <div class="bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-xl font-semibold text-gray-700 mb-4">Recent Orders</h2>
    <div class="overflow-x-auto">
      <table class="min-w-full table-auto">
        <thead>
          <tr class="bg-gray-100">
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Order ID</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Customer</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Status</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Total</th>
            <th class="px-4 py-2 text-left text-sm font-medium text-gray-600">Date</th>
          </tr>
        </thead>
        <tbody>
          <% @recent_orders.each do |order| %>
            <tr class="border-b">
              <td class="px-4 py-2 text-sm text-gray-700"><%= order.id %></td>
              <td class="px-4 py-2 text-sm text-gray-700"><%= order.user.full_name %></td>
              <td class="px-4 py-2 text-sm text-gray-700"><%= order.status.capitalize %></td>
              <td class="px-4 py-2 text-sm text-gray-700">$<%= sprintf("%.2f", order.total_amount) %></td>
              <td class="px-4 py-2 text-sm text-gray-700"><%= order.order_date.strftime("%b %d, %Y %H:%M") %></td>
            </tr>
          <% end %>
          <% if @recent_orders.empty? %>
            <tr>
              <td colspan="5" class="px-4 py-2 text-sm text-gray-500 text-center">No recent orders</td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Quick Links -->
  <div class="mt-8 text-center">
    <h2 class="text-xl font-semibold text-gray-700 mb-4">Quick Actions</h2>
    <div class="flex justify-center gap-4">
      <%= link_to admin_categories_path, class: "bg-red-600 text-white px-6 py-3 rounded-full hover:bg-red-700 transition-colors font-semibold inline-flex items-center" do %>
        <i class="fas fa-utensils mr-2"></i> Manage Categories
      <% end %>
      <%= link_to admin_users_path, class: "bg-blue-600 text-white px-6 py-3 rounded-full hover:bg-blue-700 transition-colors font-semibold inline-flex items-center" do %>
        <i class="fas fa-users mr-2"></i> Manage Users
      <% end %>
      <%= link_to admin_receipt_uploads_path, class: "bg-green-600 text-white px-6 py-3 rounded-full hover:bg-green-700 transition-colors font-semibold inline-flex items-center" do %>
        <i class="fas fa-receipt mr-2"></i> Manage Receipt Uploads
      <% end %>
    </div>
  </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
<script>
  const ctx = document.getElementById('popularItemsChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: <%= @popular_items.map { |item| item[:menu_item].name }.to_json %>,
      datasets: [{
        label: 'Items Sold',
        data: <%= @popular_items.map { |item| item[:quantity] }.to_json %>,
        backgroundColor: 'rgba(255, 99, 71, 0.8)',
        borderColor: 'rgba(255, 99, 71, 1)',
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Quantity Sold'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Menu Items'
          }
        }
      },
      plugins: {
        legend: {
          display: true,
          position: 'top'
        }
      }
    }
  });
</script>