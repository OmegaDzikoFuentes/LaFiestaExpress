<%= stylesheet_link_tag 'loyalty_card', media: 'all' %>

<div class="min-h-screen py-8 bg-gray-50">
  <div class="max-w-4xl mx-auto px-4">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-800">My Loyalty Cards</h1>
      <p class="text-gray-600 mt-2">Collect punches and earn rewards!</p>
    </div>

    <% if @current_loyalty_card %>
      <!-- Current Active Card -->
      <div class="bg-white rounded-lg shadow-lg overflow-hidden mb-8">
        <div class="bg-gradient-to-r from-mexican to-orange-600 p-6 text-white">
          <h2 class="text-2xl font-bold mb-2">Current Loyalty Card</h2>
          <p class="text-orange-100">Collect 10 punches to earn $<%= sprintf("%.2f", @current_loyalty_card.discount_amount) %> off!</p>
        </div>
        
        <div class="p-6">
          <!-- Loyalty Card Visual -->
          <div class="loyalty-card-container mb-6">
            <div class="card-content bg-gradient-to-br from-red-600 to-yellow-500 text-white p-6 rounded-lg">
              <div class="text-center mb-4">
                <div class="text-sm opacity-90">I am a VIP Customer at...</div>
              </div>
              
              <div class="text-center mb-6">
                <div class="text-2xl font-bold">La Fiesta</div>
                <div class="text-xl font-bold -mt-1">EXPRESS</div>
                <div class="text-sm opacity-90">Fresh Mexican Food</div>
              </div>
              
              <!-- Punch Grid -->
              <div class="grid grid-cols-5 gap-2 mb-6">
                <% (1..9).each do |num| %>
                  <div class="aspect-square rounded border-2 flex items-center justify-center text-sm font-bold
                              <%= num <= @current_loyalty_card.punches_count ? 'bg-white text-red-600 border-white' : 'border-white border-opacity-50 text-white' %>">
                    <%= num %>
                  </div>
                <% end %>
                <div class="aspect-square rounded border-2 border-white flex items-center justify-center text-xs font-bold
                            <%= @current_loyalty_card.punches_count >= 10 ? 'bg-white text-red-600' : 'border-opacity-50 text-white' %>">
                  $8 OFF
                </div>
              </div>
              
              <div class="text-center text-sm mb-4">
                <strong>After 10 purchases, get an $8 discount on your next purchase.</strong><br>
                <small class="opacity-75">Applicable to one meal only.</small>
              </div>
              
              <div class="text-center text-xs opacity-75 mb-2">
                <strong>1133 W Main St</strong><br>
                Troy, Ohio 45373 - (937) 703-1371
              </div>
              
              <div class="text-center text-xs opacity-75">
                One Punch Per Visit - One Card Per Customer
              </div>
            </div>
          </div>

          <!-- Progress Stats -->
          <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="text-center p-4 bg-green-50 rounded-lg">
              <div class="text-2xl font-bold text-green-600"><%= @current_loyalty_card.punches_count %></div>
              <div class="text-green-700 text-sm">Punches</div>
            </div>
            <div class="text-center p-4 bg-yellow-50 rounded-lg">
              <div class="text-2xl font-bold text-yellow-600"><%= 10 - @current_loyalty_card.punches_count %></div>
              <div class="text-yellow-700 text-sm">Remaining</div>
            </div>
            <div class="text-center p-4 bg-blue-50 rounded-lg">
              <div class="text-2xl font-bold text-blue-600">$8.00</div>
              <div class="text-blue-700 text-sm">Reward Value</div>
            </div>
          </div>

          <!-- Status -->
          <div class="text-center mb-6">
            <% if @current_loyalty_card.is_completed && !@current_loyalty_card.is_redeemed %>
              <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg">
                <i class="fas fa-gift mr-2"></i>
                <strong>Congratulations! Your card is ready to redeem!</strong>
              </div>
            <% elsif @current_loyalty_card.is_redeemed %>
              <div class="bg-gray-100 border border-gray-400 text-gray-700 px-4 py-3 rounded-lg">
                <i class="fas fa-check-circle mr-2"></i>
                <strong>This card has been redeemed</strong>
              </div>
            <% else %>
              <div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded-lg">
                <i class="fas fa-clock mr-2"></i>
                <strong>Keep collecting punches! <%= 10 - @current_loyalty_card.punches_count %> more to go!</strong>
              </div>
            <% end %>
          </div>

          <!-- Action Buttons -->
          <div class="text-center space-x-4">
            <% if @current_loyalty_card.is_completed && !@current_loyalty_card.is_redeemed %>
              <%= link_to redeem_loyalty_card_path(@current_loyalty_card), 
      method: :patch, 
      class: "bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors inline-flex items-center",
      data: { confirm: "Are you sure you want to redeem this loyalty card for $8 off?" } do %>
  <i class="fas fa-gift mr-2"></i>Redeem $8 Reward
<% end %>
            <% end %>
            
            <%= link_to new_receipt_upload_path,
    class: "bg-mexican text-white px-6 py-3 rounded-lg hover:bg-orange-600 transition-colors inline-flex items-center" do %>
  <i class="fas fa-upload mr-2"></i>Add Punch
<% end %>
          </div>
        </div>
      </div>
    <% else %>
      <!-- No Active Card -->
      <div class="bg-white rounded-lg shadow-lg p-8 text-center">
        <i class="fas fa-credit-card text-6xl text-gray-300 mb-4"></i>
        <h2 class="text-2xl font-bold text-gray-800 mb-4">No Active Loyalty Card</h2>
        <p class="text-gray-600 mb-6">Start your loyalty journey by creating your first card!</p>
        <%= link_to loyalty_cards_path, 
    method: :post,
    class: "bg-mexican text-white px-8 py-3 rounded-lg hover:bg-orange-600 transition-colors inline-flex items-center" do %>
  <i class="fas fa-plus mr-2"></i>Start Earning Rewards
<% end %>
      </div>
    <% end %>

    <!-- Back to Profile -->
    <div class="text-center mt-8">
      <%= link_to "← Back to Profile", profile_path, 
          class: "text-mexican hover:text-orange-600 font-medium" %>
    </div>
  </div>
</div>

<%= javascript_include_tag 'loyalty_card' %>